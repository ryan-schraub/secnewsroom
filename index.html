<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SEC Newsroom | High-Speed Matrix</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; padding: 20px; }
        .wrapper { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .ticker-badge { background: #003366; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; }
        .btn-analysis { background: #fd7e14; color: white; font-weight: bold; border: none; }
        .btn-analysis:hover { background: #e8590c; color: white; }
        /* Speed up: hide table until DataTables is ready */
        #filingTable { width: 100% !important; display: none; }
    </style>
</head>
<body>

<div class="wrapper">
    <h2 class="mb-4">ðŸ“Š SEC Filer Matrix <small class="text-muted" style="font-size: 0.5em;">v2.0 Performance Mode</small></h2>
    
    <table id="filingTable" class="table table-hover">
        <thead>
            <tr>
                <th>Ticker</th>
                <th>Company Name</th>
                <th>Latest 10-K</th>
                <th>10-K Doc</th>
                <th>Latest 10-Q</th>
                <th>10-Q Doc</th>
                <th>Analysis</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

<script>
async function initTable() {
    const response = await fetch('tickers_preview.csv');
    const csvData = await response.text();
    
    Papa.parse(csvData, {
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
            // Load Data into Table
            const table = $('#filingTable').DataTable({
                data: results.data,
                deferRender: true,   // THE SPEED SECRET: Only renders visible rows
                pageLength: 25,      // Smaller chunks for speed
                order: [[0, 'asc']],
                columns: [
                    { data: 'Ticker', render: d => `<span class="ticker-badge">${d}</span>` },
                    { data: 'Company' },
                    { data: 'Latest 10-K', className: 'text-muted small' },
                    { 
                        data: '10-K Link', 
                        render: link => link ? `<a href="${link}" target="_blank" class="btn btn-sm btn-outline-primary">10-K</a>` : 'â€”'
                    },
                    { data: 'Latest 10-Q', className: 'text-muted small' },
                    { 
                        data: '10-Q Link', 
                        render: link => link ? `<a href="${link}" target="_blank" class="btn btn-sm btn-outline-secondary">10-Q</a>` : 'â€”'
                    },
                    { 
                        data: 'Ticker',
                        render: (ticker) => {
                            // Automatically link if Ticker matches an existing analysis
                            const analysisTickers = ['RTX']; 
                            if (analysisTickers.includes(ticker)) {
                                return `<a href="analysis_${ticker.toLowerCase()}.html" class="btn btn-sm btn-analysis">VIEW BRIDGE</a>`;
                            }
                            return `<span class="text-muted small">Processing...</span>`;
                        }
                    }
                ],
                initComplete: function() {
                    $('#filingTable').fadeIn(); // Smoothly show table once ready
                }
            });
        }
    });
}

$(document).ready(initTable);
</script>
</body>
</html>
